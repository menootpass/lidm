<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesmen Sumatif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .progress-bar-fill {
            transition: width 0.3s ease-in-out;
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <!-- Halaman Awal untuk Mengisi Nama -->
    <div id="startScreen" class="bg-white w-full max-w-lg rounded-2xl shadow-lg p-8 text-center">
        <h1 class="text-3xl font-bold text-gray-800">Selamat Datang</h1>
        <p class="text-gray-600 mt-2">Silakan masukkan nama lengkap Anda untuk memulai asesmen.</p>
        <div class="mt-8">
            <input type="text" id="nameInput" placeholder="Ketik nama lengkap Anda di sini..." class="w-full px-4 py-3 text-lg border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-600 focus:border-transparent transition">
            <p id="nameError" class="text-red-500 text-sm mt-2 hidden">Nama tidak boleh kosong.</p>
        </div>
        <button id="startButton" class="mt-6 w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 text-lg">
            Mulai Asesmen
        </button>
    </div>

    <!-- Kontainer Asesmen Utama (Awalnya Tersembunyi) -->
    <div id="assessmentContainer" class="hidden bg-white w-full max-w-3xl rounded-2xl shadow-lg p-6 md:p-10 transition-all duration-300">
        
        <header class="mb-8 text-left">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Asesmen Sumatif</h1>
            <p class="text-gray-500 mt-1 text-lg">Pengisi: <span id="displayName" class="font-semibold"></span></p>
        </header>

        <div class="mb-8">
            <div class="flex justify-between mb-2">
                <span id="progressText" class="text-sm font-medium text-gray-600">Pertanyaan 1 dari 5</span>
                <span id="progressPercent" class="text-sm font-medium text-gray-600">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="progressBar" class="bg-gray-700 h-3 rounded-full progress-bar-fill" style="width: 0%"></div>
            </div>
        </div>

        <div id="questionContent">
            <h2 id="questionText" class="text-xl md:text-2xl font-semibold text-gray-800 mb-4">Memuat pertanyaan...</h2>
            <div id="answerContainer">
                <textarea id="answerTextarea" rows="5" class="w-full p-4 border-2 border-gray-200 rounded-lg text-lg focus:ring-2 focus:ring-gray-600 focus:border-transparent transition" placeholder="Ketik jawaban Anda di sini..."></textarea>
            </div>
        </div>
        
        <div id="completionScreen" class="hidden text-center py-10">
             <svg class="mx-auto h-20 w-20 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h2 class="text-3xl font-bold text-gray-800 mt-6">Terima Kasih!</h2>
            <p class="text-gray-600 mt-3 text-lg">Jawaban Anda telah berhasil dikirim.</p>
        </div>

        <footer id="navigation" class="mt-10 pt-6 border-t border-gray-200 flex justify-between items-center">
            <button id="prevButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Sebelumnya
            </button>
            <button id="nextButton" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300">
                Selanjutnya
            </button>
        </footer>
    </div>
    
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-8 text-center">
            <div id="modalContent">
                <h3 class="text-2xl font-bold text-gray-800">Kirim Jawaban?</h3>
                <p class="text-gray-600 mt-4">Apakah Anda yakin ingin mengirim semua jawaban sekarang? Anda tidak dapat mengubahnya kembali setelah dikirim.</p>
                <div class="mt-8 flex justify-center gap-4">
                    <button id="cancelButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-colors duration-300">Batal</button>
                    <button id="confirmSubmitButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300">Ya, Kirim</button>
                </div>
            </div>
            <div id="modalLoading" class="hidden">
                 <div class="loader mx-auto"></div>
                 <p class="text-gray-600 mt-4">Sedang mengirim jawaban...</p>
            </div>
        </div>
    </div>

    <script>
        // !!! PENTING !!! Ganti URL ini dengan URL Web App dari Google Apps Script Anda
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzpZOp7VjTNEVNAegxDUsXgQbKwi57FJ-aUNhLzZB78a9lytkO0JLx_lKHBk3okXfv3/exec'; 
        
        const questions = [
            { question: "Setelah melakukan kegiatan pembelajaran hari ini, apakah terdapat pemahaman baru yang diperoleh anda?" },
            { question: "Apakah website/media pembelajaran yang digunakan membantu anda dalam memahami sains dalam sehari-hari?" },
            { question: "Apakah menurut anda menarik dan mudah dipahami?" },
            { question: "Kenapa tidak boleh menggunakan deterjen terus menerus?" },
            { question: "Menurut anda, Baking soda termasuk dalam bahan kimia sintetis atau alami?" }
        ];

        let currentQuestionIndex = 0;
        let userName = '';
        const userAnswers = new Array(questions.length).fill('');

        // --- ELEMEN DOM ---
        const startScreen = document.getElementById('startScreen');
        const nameInput = document.getElementById('nameInput');
        const startButton = document.getElementById('startButton');
        const nameError = document.getElementById('nameError');
        const assessmentContainer = document.getElementById('assessmentContainer');
        const displayName = document.getElementById('displayName');
        const questionText = document.getElementById('questionText');
        const answerTextarea = document.getElementById('answerTextarea');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progressPercent = document.getElementById('progressPercent');
        const completionScreen = document.getElementById('completionScreen');
        const navigation = document.getElementById('navigation');
        const confirmModal = document.getElementById('confirmModal');
        const modalContent = document.getElementById('modalContent');
        const modalLoading = document.getElementById('modalLoading');
        const cancelButton = document.getElementById('cancelButton');
        const confirmSubmitButton = document.getElementById('confirmSubmitButton');

        function loadQuestion(index) {
            const questionData = questions[index];
            questionText.textContent = questionData.question;
            answerTextarea.value = userAnswers[index] || ''; // Muat jawaban yang tersimpan
            answerTextarea.focus();
            updateNavigation();
            updateProgressBar();
        }
        
        function saveCurrentAnswer() {
            userAnswers[currentQuestionIndex] = answerTextarea.value.trim();
        }

        function updateNavigation() {
            prevButton.disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === questions.length - 1) {
                nextButton.textContent = 'Kirim Jawaban';
                nextButton.classList.remove('bg-gray-800', 'hover:bg-gray-900');
                nextButton.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                nextButton.textContent = 'Selanjutnya';
                nextButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                nextButton.classList.add('bg-gray-800', 'hover:bg-gray-900');
            }
        }
        
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `Pertanyaan ${currentQuestionIndex + 1} dari ${questions.length}`;
            progressPercent.textContent = `${Math.round(progress)}%`;
        }
        
        function showConfirmModal() {
            modalContent.style.display = 'block';
            modalLoading.style.display = 'none';
            confirmModal.classList.remove('opacity-0', 'pointer-events-none');
        }

        function hideConfirmModal() {
            confirmModal.classList.add('opacity-0', 'pointer-events-none');
        }

        function showCompletionScreen() {
            assessmentContainer.innerHTML = ''; // Hapus semua konten asesmen
            assessmentContainer.appendChild(completionScreen); // Tampilkan layar selesai
            completionScreen.classList.remove('hidden');
        }

        function submitData() {
            modalContent.style.display = 'none';
            modalLoading.style.display = 'block';
            
            const payload = {
                nama_pengisi: userName,
                q1: userAnswers[0] || '',
                q2: userAnswers[1] || '',
                q3: userAnswers[2] || '',
                q4: userAnswers[3] || '',
                q5: userAnswers[4] || '',
            };

            console.log('Sending payload:', payload);

            // Coba dengan fetch no-cors terlebih dahulu
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(() => {
                console.log('Data sent with fetch no-cors mode');
                // Tunggu sebentar untuk memastikan data terkirim
                setTimeout(() => {
                    hideConfirmModal();
                    showCompletionScreen();
                }, 1000);
            })
            .catch(error => {
                console.error('Fetch error:', error);
                hideConfirmModal();
                alert('Terjadi kesalahan saat mengirim jawaban. Silakan coba lagi.');
            });
        }
        
        // --- EVENT LISTENERS ---

        startButton.addEventListener('click', () => {
            userName = nameInput.value.trim();
            if (userName) {
                nameError.classList.add('hidden');
                displayName.textContent = userName;
                startScreen.classList.add('hidden');
                assessmentContainer.classList.remove('hidden');
                loadQuestion(currentQuestionIndex);
            } else {
                nameError.classList.remove('hidden');
            }
        });
        
        nextButton.addEventListener('click', () => {
            saveCurrentAnswer();
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion(currentQuestionIndex);
            } else {
                showConfirmModal();
            }
        });

        prevButton.addEventListener('click', () => {
            saveCurrentAnswer();
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion(currentQuestionIndex);
            }
        });
        
        cancelButton.addEventListener('click', hideConfirmModal);
        confirmSubmitButton.addEventListener('click', () => {
             saveCurrentAnswer();
             submitData();
        });
    </script>
</body>
</html>

